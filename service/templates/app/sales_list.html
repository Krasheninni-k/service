{% extends "base.html" %}
{% block title %}
Продажи
{% endblock %}
{% block content %}
  <div class="col d-flex justify-content-center">
    <div class="card" style="width: 60rem;">
      <div class="card-header">
        <div class="row">
          <div class="col-md-3">
            <span><b>{{ current_date|date:"F" }}</b>
              <br>Количество продаж: {{ count_sales }}
              <br>Продано товаров: {{ goods_list.count_goods }}
              <br>
              <br><b> Список продаж: </b>
            </span>
          </div>
          <div class="col-md-3">
            <span>
              <br>Сумма продаж: {{ goods_list.sum_sale }}
              <br>Маржа: {{ goods_list.sum_margin }}
            </span>
          </div>
          <div class="col-md-3">
              <span class="{% if total_margin < 30 %}text-danger{% endif %}">
              <br>Маржинальность: {{ total_margin|floatformat:-2 }} %</span>
              <span class="{% if total_markup < 42.8 %}text-danger{% endif %}">
              <br>Наценка: {{ total_markup|floatformat:-2 }} %</span>
          </div>
          <div class="col-md-3 d-flex justify-content-end align-items-center">
            <a class="btn btn-primary align-self-end" href="{% url 'app:sale_add' %}" role="button">Новая продажа</a>
          </div>
        </div>
      </div>
      <div class="card-body">
        <table class="table">
          <thead>
            <tr>
              <th>№</th>
              <th style="width: 120px;">Дата</th>
              <th style="width: 300px;">Состав продажи</th>
              <th>Сумма сделки</th>
              <th>Тип клиента</th>
              <th>Способ оплаты</th>
              <th>Способ получения</th>
            </tr>
          </thead>
          <tbody> 
            {% for sale in page_obj %}
            <tr>
              <td>{{ sale.sale_number }}</td>
              <td>{{ sale.sale_date|date:"d-m-Y" }}</td>
              <td>{{ sale.product_list }}</td>
              <td>{{ sale.total_price|floatformat:-2 }}</td>
              <td>{{ sale.client_type }}</td>
              <td>{{ sale.payment_type }}</td>
              <td>{{ sale.receiving_type }}</td>
              <td>
                <a class="btn btn-sm text-muted" href="{% url 'app:sale_detail' sale.sale_number %}" role="button">
                  Детали
                </a>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% include "includes/paginator.html" %}
{% endblock %}